<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css">
    <title>Title</title>
</head>
<body>
<div id="main-container">
    <div id="left-sideTab">
        <div class="floating-box" id="zoom-container">
            <button onclick="zoomIn()" class="zoom-btn">+</button>
            <button onclick="zoomOut()" class="zoom-btn">-</button>
        </div>

        <div id="left-backBtn" class="arrow-head"></div>

        <h2>Settings</h2>

        <div class="form-group">
            <label>Table ID</label>
            <input type="number" id="input-tableId" placeholder="Table id">
        </div>

        <div class="form-group">
            <span>Select Option</span>
            <div class="radio-group">
                <input type="radio" id="option1" name="tableSize" data-table-size="1" class="radio-custom">
                <label for="option1" class="radio-label">1 ì¸ì„</label>

                <input type="radio" id="option2" name="tableSize" data-table-size="4" class="radio-custom">
                <label for="option2" class="radio-label">4 ì¸ì„</label></div>
        </div>
    </div>

    <div id="workspace">

        <div class="container-line attachable item">
            <div class="container-draggable attachable" draggable="true">
            </div>
            <div class="container-draggable attachable" draggable="true">
            </div>

            <div class="container-draggable attachable" draggable="true">
            </div>
        </div>

        <div class="container-line attachable item">
            <div>
                <h3 style="margin: 0px" draggable="false">Area1</h3>
            </div>
            <div class="container-draggable attachable" draggable="true">
            </div>

            <div class="container-draggable attachable" draggable="true">
            </div>

            <div class="container-draggable attachable" draggable="true">
            </div>
        </div>
    </div>


    <div id="tool-container">
        <div style="height: 32%">
            <h3 style="margin: 0px; color: white;">Table</h3>
            <div class="tool-container-detail">
                <div style="justify-content: center; align-items: center; display: flex; height: 100%">
                    <div class="table-container">
                        <div style="height: 80%; justify-content: center; align-items: center; display: flex;">
                            <button id="table-1" data-table-size="1" data-table-id="1"
                                    class="draggable resource table-1" draggable="true" style="font-size: 7px;">
                                <h2>T 1<br>00:00</h2>
                            </button>
                        </div>
                        <p><1 ì¸ì„></p>
                    </div>
                    <div class="table-container">
                        <div style="height: 80%; justify-content: center; align-items: center; display: flex;">

                            <button id="table-4" data-table-size="4" data-table-id="1"
                                    class="draggable resource table-4" draggable="true" style="font-size: 8px;">
                                <h2>T 1<br>00:00</h2>
                            </button>
                        </div>
                        <p><4 ì¸ì„></p>
                    </div>
                </div>
            </div>
        </div>
        <div style="height: 32%">
            <h3 style="margin: 0px; color: white;">Line</h3>
            <div class="tool-container-detail"
                 style="display: grid; grid-template-rows: 1fr 1fr">
                <div class="container-draggable attachable resource" draggable="true"
                     style="flex-direction: column;  text-align: left">
                    Vertical
                </div>
                <div class="container-draggable attachable resource" draggable="true">
                    Horizontal
                </div>
            </div>
        </div>
        <div style="height: 32%">
            <h3 style="margin: 0px; color: white;">Area</h3>
            <div class="tool-container-detail" style="display: grid; grid-template-rows: 1fr 1fr">
                <div class="container-line attachable item resource" draggable="true" style="flex-direction: column;">
                    <h3 style="margin: 0px">Vertical</h3>
                </div>
                <div class="container-line attachable item resource" draggable="true" style="flex-direction: row">
                    <h3 style="margin: 0px; flex-direction: column">Horizontal</h3>
                </div>
            </div>
        </div>
        <button id="tool-container-toggleBtn" class="circle-button">&gt;</button>
        <div class="floating-box waste-btn" id="waste-container">
            ğŸ—‘
        </div>
    </div>
</div>


<!-- ì‚­ì œë¡œì§2 -->
<!-- ë¶€ë¶„ ì„±ê³µ : item ìš”ì†ŒëŠ” ë˜ëŠ”ë° , draggable ìš”ì†ŒëŠ” ì•ˆë¨ -->
<!-- draggable ëŠ” waste_basket ì—ì„œ dragoverë¡œ ì²˜ë¦¬í•´ì•¼í•  ê²ƒ ê°™ë‹¤.  -->
<script>
    //divê°€ ì¤‘ì²©ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ë©”ì„œë“œ
    function isOverlapping(x, y) {
        const rect1 = x;
        const rect2 = y;

        return !(
            rect1.top > rect2.bottom ||
            rect1.right < rect2.left ||
            rect1.bottom < rect2.top ||
            rect1.left > rect2.right
        );
    }

    let inWasteBasket = false;

    //ì“°ë ˆê¸°í†µ ì•ˆìœ¼ë¡œ ì™”ì„ ë•Œ íŒë‹¨í•´ì„œ íš¨ê³¼ë¥¼ ì£¼ëŠ” í•¨ìˆ˜
    function wasteIn(remove, position = remove.getBoundingClientRect()) {
        if (isOverlapping(position,
            wasteBasket.getBoundingClientRect())) { //ì“°ë ˆê¸°í†µ ì•ˆìœ¼ë¡œ ë“¤ì–´ì™”ë‹¤ë©´
            if (inWasteBasket) return; //í´ë˜ìŠ¤ê°€ ê³„ì† ì¶”ê°€ë˜ëŠ” ê²½ìš°ë¥¼ ë°©ì§€í•œë‹¤.

            //css ì˜µì…˜ì„ ì¤€ë‹¤.
            remove.classList.add("waste-in-object");
            wasteBasket.classList.add("waste-in");
            inWasteBasket = true;
        } else { //ê²¹ì¹˜ì§€ ì•Šì•˜ë‹¤ë©´ --> ì“°ë ˆê¸°í†µ ë°–ìœ¼ë¡œ ë‚˜ì™”ë‹¤ë©´
            //ì¶”ê°€í–ˆë˜ css ì˜µì…˜ì„ ì œê±°í•œë‹¤.
            remove.classList.remove("waste-in-object");
            wasteBasket.classList.remove("waste-in");
            inWasteBasket = false;
        }
    }

    function setRemoveItemEvent(item) {
        //ë§ˆìš°ìŠ¤ ì˜¤ë²„ë¥¼ í•  ë•Œ ì“°ë ˆê¸°í†µ ì•ˆì— ê°ì²´ê°€ ìˆë‹¤ë©´ ìƒ‰ ë³€ê²½ ë° í”Œë˜ê·¸ ì„¤ì •
        item.addEventListener("mousemove", () => wasteIn(item));
        item.addEventListener("touchmove", () => wasteIn(item));

        //ë§ˆìš°ìŠ¤ê°€ ëë‚¬ì„ ë•Œ ë°œìƒí•˜ëŠ” ì´ë²¤íŠ¸
        item.addEventListener("mouseup", () => checkWasteOverlapping(item));
        item.addEventListener("touchend", () => checkWasteOverlapping(item));
    }

    function checkWasteOverlapping(item) {
        if (isOverlapping(wasteBasket.getBoundingClientRect(),
            item.getBoundingClientRect())) item.remove(); //ë§ˆìš°ìŠ¤ë¥¼ ë†“ì€ ê³³ì´ ê°ì²´ ì•ˆì— ìˆë‹¤ë©´ ê·¸ ìš”ì†Œë¥¼ ì‚¬ì í•˜ê² ë‹¤.
        wasteBasket.classList.remove("waste-in");
    }

    function setRemoveDragEvent(drag) {
        drag.addEventListener("drag", e => {
            wasteIn(drag, new DOMRect(e.clientX, e.clientY, 1, 1))
        })

        drag.addEventListener("touchmove", e => {
            wasteIn(drag, new DOMRect(e.touches[0].clientX, e.touches[0].clientY, 1, 1))
        });

        drag.addEventListener("dragend", e => {
            if (isOverlapping(wasteBasket.getBoundingClientRect(),
                new DOMRect(e.clientX, e.clientY, 1, 1))) drag.remove();
            wasteBasket.classList.remove("waste-in"); //ì¢…ë£Œ ì‹œì ì— ê²°ê³¼ì— ìƒê´€ì—†ì´ íœ´ì§€í†µì„ ì›ë˜ëŒ€ë¡œ í•œë‹¤.
        })

        drag.addEventListener("touchend", e => {
            e.stopPropagation();
            if (isOverlapping(wasteBasket.getBoundingClientRect(),
                new DOMRect(e.changedTouches[0].pageX, e.changedTouches[0].pageY, 1, 1))) drag.remove();
            wasteBasket.classList.remove("waste-in"); //ì¢…ë£Œ ì‹œì ì— ê²°ê³¼ì— ìƒê´€ì—†ì´ íœ´ì§€í†µì„ ì›ë˜ëŒ€ë¡œ í•œë‹¤.
        })
    }

    //ììœ ë¡­ê²Œ ì›€ì§ì¼ ìˆ˜ ìˆëŠ” ìš”ì†Œë“¤
    const removableItemList = document.querySelectorAll(".item");

    //ë¶™ì—¬ì§€ëŠ” ìš”ì†Œë“¤
    const removableDragList = document.querySelectorAll(".draggable, .container-draggable")
    const wasteBasket = document.getElementById("waste-container");

    removableItemList.forEach(removable => {
        setRemoveItemEvent(removable);
    })

    removableDragList.forEach(removable => {
        setRemoveDragEvent(removable);
    })
</script>

<!-- resource ë¡œì§ -->
<script>
    let resourceDragend;
    //ëª¨ë“  ìì›ì„ ê°€ì ¸ì˜¨ë‹¤.
    let resources = document.querySelectorAll(".resource");

    resources.forEach(resource => {
        if (resource.classList.contains("item")) {
            resource.addEventListener("drag", e => {
                resourceDragend = resource;
            })



            resource.addEventListener("touchstart", e => {
                resourceDragend = resource;
            })

            resource.addEventListener("touchend", e => {
                resourceItemDrop(e);
            });
        }
    })

</script>

<!-- ìë¦¬ ìŠ¤ìœ„ì¹­ ë¡œì§ -->
<script>
    let isDrag = false;
    //resourceë¥¼ ê°€ì ¸ì˜¨ë‹¤.
    //let resourceTableContainer = document.q(".resource.draggable").values();

    const leftSideTab = document.getElementById('left-sideTab');

    //ë¶™ì´ëŠ” ìš”ì†Œë“¤ ê°€ì ¸ì˜¨ë‹¤.
    const draggables = document.querySelectorAll(".draggable");
    draggables.forEach(container => {
        setDraggableEvent(container);
    })

    //ëª¨ë“  1ë‹¨ê³„ ì»¨í…Œì´ë„ˆë¥¼ ê°€ì ¸ì˜¨ë‹¤.
    const draggableContainers = document.querySelectorAll(".container-draggable");
    draggableContainers.forEach(container => {
        setDraggableEvent(container);

        if (!container.classList.contains("resource")) {
            setContainerAttachEvent(container, "draggable");//ì´ ì»¨í…Œì´ì— ë‹´ì„ ìˆ˜ ìˆëŠ” ìš”ì†Œ
        }
    })

    //ëª¨ë“  2ë‹¨ê³„ ì»¨í…Œì´ë„ˆë¥¼ ê°€ì ¸ì˜¨ë‹¤.
    const lineContainers = document.querySelectorAll(".container-line");
    lineContainers.forEach(container => {
        if (!container.classList.contains("resource")) {
            setContainerAttachEvent(container, "container-draggable"); //ì´ ì»¨í…Œì´ì— ë‹´ì„ ìˆ˜ ìˆëŠ” ìš”ì†Œ
        }
    })

    //í…Œì´ë¸” idë¥¼ ë³€ê²½í•˜ëŠ” ë¡œì§
    let focusSetNumberTable;
    const inputTableId = document.getElementById("input-tableId");
    const tableSizeBtns = document.getElementsByName("tableSize");

    //í…ìŠ¤íŠ¸ ì‚¬ìš©ìì— ë‚´ìš©ì´ ë³€ê²½ë˜ëŠ” ê²½ìš°
    inputTableId.addEventListener("change", e => {
        focusSetNumberTable.dataset.tableId = e.target.value;
        tabletNumberTextChange(focusSetNumberTable);
    })

    //ì‚¬ì´ì¦ˆê°€ ë³€í•˜ëŠ” ê²½ìš°
    tableSizeBtns.forEach(btn => {
        btn.addEventListener("change", e => {
            focusSetNumberTable.classList.remove("table-" + focusSetNumberTable.dataset.tableSize);
            focusSetNumberTable.classList.add("table-" + btn.dataset.tableSize);
            focusSetNumberTable.dataset.tableSize = btn.dataset.tableSize;
        });
    })

    //í´ë¦­í•´ì„œ í…Œì´ë¸” ë²ˆí˜¸ ì €ì¥
    function setNumberTable(table) {
        if (focusSetNumberTable !== undefined)
            focusSetNumberTable.classList.toggle("focus"); //ì›ë˜ ì„ íƒëœ ê°ì²´ ì„ íƒ í•´ì œ

        if (focusSetNumberTable === table) { //ê¸°ì¡´ì— ì„ íƒí•œ í…Œì´ë¸” ë‹¤ì‹œ ì„ íƒí•˜ë©´ ì·¨ì†Œ
            focusSetNumberTable = undefined;
            leftSideTab.classList.remove("open");
            return;
        }

        focusSetNumberTable = table;
        focusSetNumberTable.classList.toggle("focus");

        tableSizeBtns.forEach(btn => {
            console.log(`table ${table.dataset.tableSize}`)
            if (btn.dataset.tableSize === table.dataset.tableSize)
                btn.checked = true;
        })

        inputTableId.value = Number(table.dataset.tableId);
        leftSideTab.classList.add("open");
    }

    let afterImage; //tocuh í–ˆì„ ë•Œ ììƒ ì´ë¯¸ì§€ë¥¼ ë³´ì—¬ì¤€ë‹¤.
    let touchedFlag = false;

    //ë“œë ˆê·¸
    function setDraggableEvent(draggable) {
        //ë“œë ˆê·¸ê°€ ì‹œì‘ëœ ê²½ìš° ìƒíƒœë¥¼ ë³€ê²½
        draggable.addEventListener("dragstart", e => setStartDragEvent(draggable, e));
        draggable.addEventListener("touchstart", e => {
            setStartDragEvent(draggable, e);
        });

        draggable.addEventListener("touchmove", e => {
            if(touchedFlag) return;
            touchedFlag = true;
            //ì”ìƒ ì²˜ë¦¬
            afterImage = draggable.cloneNode(true);
            console.log(`afterImage ${afterImage}`)

            afterImage.removeAttribute("id");
            afterImage.classList.add("afterImage")
            document.getElementById("main-container").appendChild(afterImage);

        })

        //ë“œë ˆê·¸ê°€ ëë‚˜ë©´ ìƒíƒœë¥¼ ì¢…ë£Œí•œë‹¤.
        draggable.addEventListener("dragend", e => setEndDragEvent(draggable, e));
        draggable.addEventListener("touchend", e => {
            setEndDragEvent(draggable, e);
            afterImage.remove();
            touchedFlag = false;
        });
    }


    document.addEventListener("touchmove", e => {
        if(afterImage === undefined) return;

        setTranslate(e.touches[0].clientX - afterImage.getBoundingClientRect().width / 2
            , e.touches[0].clientY - afterImage.getBoundingClientRect().height / 2
            , afterImage);

        const touchElement = document.elementFromPoint(e.touches[0].clientX, e.touches[0].clientY);

        if(touchElement.classList.contains("attachable")){
            const isHorizontal = getComputedStyle(touchElement).flexDirection === "row";
            draggableInContainer(touchElement, getTargetType(touchElement), e, isHorizontal);
        }

    })

    function setStartDragEvent(draggable, event) {
        event.stopPropagation()
        isDrag = true;
        draggable.classList.add("dragging");
        console.log("drag start!")
    }

    function setEndDragEvent(draggable, event) {
        //event.stopPropagation(); // ì¢…ë£Œë˜ëŠ”ê±´ ì „íŒŒë˜ì–´ë„ ë˜ì§€ ì•Šì„ê¹Œ?
        isDrag = false;
        draggable.classList.remove("dragging");
        console.log("drag end!")
    }

    function getTargetType(container){
        let targetType;

        if (container.classList.contains("container-draggable"))
            targetType = "draggable";
        else if (container.classList.contains("container-line"))
            targetType = "container-draggable";


        return targetType;
    }


    function setContainerAttachEvent(container, target) {
        let targetType = target === undefined ? getTargetType(container) : target;

        const isHorizontal = getComputedStyle(container).flexDirection === "row";

        //ë§ˆìš°ìŠ¤ê°€ container ì˜ì—­ìœ¼ë¡œ ì´ë™í–ˆë‹¤ë©´
        container.addEventListener("dragover", e => { //ë“œë ˆê·¸ ì˜¤ë²„ ìƒíƒœë©´ ê³„ì† ë°œìƒí•˜ëŠ” ì´ë²¤íŠ¸
            draggableInContainer(container, targetType, e, isHorizontal);
        });
        // container.addEventListener("touchmove", e=> {
        //     draggableInContainer(container, targetType, e, isHorizontal);
        // })
    }

    function draggableInContainer(container, targetType, event, isHorizontal) {
        //ëª¨ë“  ì»¨í…Œì´ë„ˆë“¤ì— ëŒ€í•´ì„œ ì´ë²¤íŠ¸ë¥¼ ì¶”ê°€í•œë‹¤.
        let draggable = document.querySelector(".dragging"); //ì„ íƒëœ í•­ëª©ì„ ê°€ì ¸ì˜¨ë‹¤.
        console.log("dragover! : " + draggable);

        if (draggable === null) return;
        if (!draggable.classList.contains(targetType)) return //containerì— ë„£ì„ ìˆ˜ ìˆëŠ” í•­ëª©ì¸ì§€ í™•ì¸í•œë‹¤.


        event.preventDefault(); //ì–´ë–¤ ì˜ë¯¸ì¸ì§€ ì˜ ëª¨ë¥´ê² êµ°... íŠ¹ì • ì´ë²¤íŠ¸ë¥¼ ì¤‘ì‹œí‚¤ëŠ” ê²ƒ ê°™ê¸´í•œë°...
        //event.stopPropagation(); //ë¶€ëª¨ ê°ì²´ë¡œ ì˜ˆì™¸ ì „íŒŒ ë°©ì§€ --> ìœ„ì—ì„œ ì˜ˆì™¸ì²˜ë¦¬ í•˜ê¸° ë•Œë¬¸ì— ì—†ì–´ë„ ê´œì°®ì„ ë“¯

        const afterElement = getDragAfterElement(container, event, targetType, isHorizontal); //ë§ˆìš°ìŠ¤ ì¢Œí‘œì—ì„œ ê°€ì¥ ì˜¤ë¥¸ìª½ì— ìˆëŠ” í•­ëª©ì„ ê°€ì ¸ì˜¨ë‹¤.

        if (draggable.classList.contains("resource")) { //ì‚­ì œë˜ì§€ ì•ŠëŠ” ìš”ì†Œë¼ê³  í•˜ë©´
            let x = draggable.cloneNode(true);

            //ì´ë²¤íŠ¸ ë°”ì¸ë”©
            setDraggableEvent(x);
            setRemoveDragEvent(x);
            if (draggable.classList.contains("container-draggable")) {
                setContainerAttachEvent(draggable, "draggable");
                draggable.innerText = draggable.innerText.trim().substring(0, 1);
            }

            x.classList.remove("dragging");
            draggable.classList.remove("resource");
            draggable.removeAttribute("id");
            console.log("id : " + x.id.toString())

            draggable.after(x);

            //í…Œì´ë¸” ë²ˆí˜¸ ìµœì‹ í™”
            if (x.classList.contains("draggable")) {
                draggable.addEventListener("mousedown", e => {
                    e.stopPropagation();
                    setNumberTable(draggable);
                });

                // draggable.addEventListener("touchstart", e => {
                //     setNumberTable(draggable);
                // })
                const tableNumber = (Number(draggable.dataset.tableId) + 1).toString();
                tableNumberTable(tableNumber);
            }
        }

        if (afterElement === undefined) { //ì˜¤ë¥¸ìª½ì— í•­ëª©ì´ ì—†ë‹¤ë©´
            container.appendChild(draggable); //ê°€ì¥ ë’¤ì— ì¶”ê°€í•´ì¤€ë‹¤.
        } else {
            container.insertBefore(draggable, afterElement);
        }
    }


    function tableNumberTable(tableNumber) {
        const table1 = document.getElementById("table-1");
        const table4 = document.getElementById("table-4");

        table1.dataset.tableId = tableNumber;
        table4.dataset.tableId = tableNumber;

        tabletNumberTextChange(table1);
        tabletNumberTextChange(table4);
    }

    function tabletNumberTextChange(table) {
        table.innerHTML = `<h2>T ${table.dataset.tableId}<br>00:00</h2>`;
    }

    //ì»¨í…Œì´í„° ë‚´ì— ì„ íƒë˜ì§€ ì•Šì€ í•­ëª©ë“¤ ì¤‘ì— ë§ˆìš°ìŠ¤ ì™¼ì©ì— ìˆëŠ” í•­ëª©ì„ ë¦¬í„´í•˜ëŠ” í•¨ìˆ˜
    function getDragAfterElement(container, e, targetType, isHorizontal) {
        const draggableElements = [
            //... -> ë°°ì—´ë¡œ ê°€ì ¸ì˜¨ë‹¤.
            ...container.querySelectorAll(`.${targetType}:not(.dragging)`), // ì»¨í…Œì´ë„ˆ ëª©ë¡ì¤‘ì— targetType ìš”ì†Œì¤‘ dragging ì´ ì•„ë‹Œ ê²ƒì„ ê°€ì ¸ì˜¨ë‹¤.
        ];

        //ì„ íƒë˜ì§€ ì•Šì€ í•­ëª©ë“¤ì˜ ë§ˆìš°ìŠ¤ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê°€ì¥ ì˜¤ë¥¸ìª½ì— ìˆëŠ” í•­ëª©ì„ ê°€ì ¸ì˜¨ë‹¤.
        return draggableElements.reduce( //ì½œë°± ë©”ì„œë“œë¥¼ ë°°ì—´ ë§Œí¼ ì‹¤í–‰í•˜ê³  í•˜ë‚˜ì˜ ê°’ì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜
            (closest, child) => {
                const box = child.getBoundingClientRect(); //ë„í˜• ì •ë³´ë¥¼ ê°€ì ¸ì˜¨ë‹¤.
                //ë§ˆìš°ìŠ¤ xì¢Œí‘œ - ë°•ìŠ¤ ì™¼ìª½ ìœ„ì¹˜ - ë°•ìŠ¤ ë„“ì´ / 2
                //affset ê°’ì´ ìŒìˆ˜ë¼ë©´ ë§ˆìš°ìŠ¤ ê¸°ì¤€ìœ¼ë¡œ ë°•ìŠ¤ ì¤‘ì‹¬ì´ ì˜¤ë¥¸ìª½ì— ìˆê³  ì–‘ìˆ˜ë¼ë©´ ì™¼ìª½ì— ìˆë‹¤.(ë°•ìŠ¤ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë§ˆìš°ìŠ¤ëŠ” ì™¼ìª½, ì˜¤ë¥¸ìª½ì— ìˆë‹¤.)
                let offset;
                if (isHorizontal)
                    offset = (e.type === "dragover" ? e.clientX : e.touches[0].clientX)
                        - (box.left + box.width / 2);
                else
                    offset =(e.type === "dragover" ? e.clientY : e.touches[0].clientY)
                        - (box.top + box.height / 2);

                //ë§ˆìš°ìŠ¤ ì¢Œí‘œê°€ ë„í˜•ë³´ë‹¤ ì™¼ìª½ì— ìˆê³  ì „ í•­ëª©ë³´ë‹¤ 0ì— ê°€ê¹ë‹¤ë©´ offsetê°’ê³¼ í•­ëª©ì„ ê°±ì‹ 
                if (offset < 0 && offset > closest.offset) {
                    return {offset: offset, element: child};
                } else { //ì•„ë‹ˆë©´ ì›ë˜ ê°’ ë‹¤ì‹œ ê°±ì‹ 
                    return closest;
                }
            },
            {offset: Number.NEGATIVE_INFINITY}
        ).element;
    }
</script>

<!-- ììœ ë¡­ê²Œ ì›€ì§ì´ëŠ” ë¡œì§ -->
<script>
    //itemë¥¼ ìê²¨ì˜¨ë‹¤.
    var dragItem = document.querySelectorAll(".item");
    //containerë¥¼ ê°€ì ¸ì˜¨ë‹¤.
    var container = document.querySelector("#workspace");

    var active = false;
    var target
    var currentX;
    var currentY;
    var initialX;
    var initialY;
    //translate3dì— ìˆëŠ” ê°’ì„ ë°˜ì˜í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— Offset ê°’ì„ ì €ì¥í•´ì•¼ ëœë‹¤.
    var itemOffPositionMap = new Map();
    dragItem.forEach(item => {
        if (item.classList.contains("resource"))
            return;
        itemOffPositionMap.set(item, {x: 0, y: 0});
    })

    //í„°ì¹˜ ì´ë²¤íŠ¸ì— ëŒ€í•œ ì²˜ë¦¬
    container.addEventListener("touchstart", dragStart, false);
    container.addEventListener("touchend", dragEnd, false);
    container.addEventListener("touchmove", drag, false);
    //ë§ˆìš°ìŠ¤ í´ë¦­ì— ëŒ€í•œ ì´ë²¤íŠ¸ ì²˜ë¦¬
    container.addEventListener("mousedown", dragStart, false);
    container.addEventListener("mouseup", dragEnd, false);
    container.addEventListener("mousemove", drag, false);

    //resource itemì¸ drop ëœ ê²½ìš°
    container.addEventListener("drop", e => {
        resourceItemDrop(e);
    });



    function resourceItemDrop(e){
        e.preventDefault();
        if (resourceDragend === undefined) return;
        let clone = resourceDragend.cloneNode(true); //ê¹Šì€ ë³µì‚¬
        let isTouch = e.type === "touchend";

        //itemì— ë§ëŠ” ì†ì„±ìœ¼ë¡œ ì´ˆê¸°í™”
        clone.classList.remove("resource");
        clone.draggable = false;
        clone.style.position = "absolute"
        container.appendChild(clone);

        //ì¤‘ì‹¬ì„ ê¸°ì¤€ìœ¼ë¡œ ì¢Œí‘œ êµ¬í•˜ê¸° ë° mapì— ë“±ë¡
        console.log("isTouch : " + isTouch);
        let initPosition = {
            x: (isTouch ? e.changedTouches[0].pageX : e.clientX) - container.getBoundingClientRect().width / 2,
            y: (isTouch ? e.changedTouches[0].pageY : e.clientY) - container.getBoundingClientRect().height / 2
        };


        itemOffPositionMap.set(clone, initPosition);

        //êµ¬í•œ ì¢Œí‘œë¡œ ì´ë™ ë°
        setTranslate(initPosition.x, initPosition.y, clone);

        //í…ìŠ¤íŠ¸ ë³€ê²½
        clone.innerHTML = `<h3 style="margin: 0px">${clone.innerText.trim().substring(0, 1)}</h3>`;


        //ì´ë²¤íŠ¸ ë°”ì¸ë“œ
        setContainerAttachEvent(clone);
        setRemoveItemEvent(clone);

        resourceDragend = undefined;
    }


    container.addEventListener("dragover", e => e.preventDefault());

    function dragStart(e) {
        if (isDrag) return;
        if (active || e.target === container) return
        if (e.target.draggable == true) return;
        target = e.target

        while (target.parentNode !== container) {
            target = target.parentNode;
        }

        if (itemOffPositionMap.has(target)) { //dragItem ì´ í´ë¦°ëœ ê²½ìš°
            let offset = itemOffPositionMap.get(target);

            if (e.type === "touchstart") {
                initialX = e.touches[0].clientX - offset.x
                initialY = e.touches[0].clientY - offset.y
            } else {
                initialX = e.clientX - offset.x;
                initialY = e.clientY - offset.y;
            }

            active = true;
        }
    }

    function dragEnd() {
        if (active) { //dragItem ì´ í´ë¦°ëœ ê²½ìš°
            var offset = itemOffPositionMap.get(target)
            offset.x = currentX
            offset.y = currentY
        }
        active = false;
    }

    function drag(e) {
        if (active) { //dragItem ì„ íƒëœ ê²½ìš°
            e.preventDefault();

            if (e.type === "touchmove") { //í„°ì¹˜í•œ ìƒíƒœë¡œ ì´ë™í•œ ê²½ìš°
                currentX = e.touches[0].clientX - initialX;
                currentY = e.touches[0].clientY - initialY;
            } else { //ë§ˆìš°ìŠ¤ë¡œ ì´ë™í•˜ëŠ” ê²½ìš°
                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;
            }

            setTranslate(currentX, currentY, target);
        }
    }

    let scale = 1;

    function setTranslate(xPos, yPos, el) {
        el.style.transform = "translate3d(" + xPos + "px, " + yPos + "px, 0) scale(" + scale + ")";
    }

</script>

<!-- ì¤Œì¸ ì•„ì›ƒ -->
<!-- ì™¼ìª½ í™”ë©´ ì ‘ê¸° -->
<script>

    function zoomIn() {
        scale += 0.1;
        itemOffPositionMap.values()
        itemOffPositionMap.forEach((value, key) => {
            setTranslate(value.x, value.y, key);
        })

    }

    function zoomOut() {
        if (scale <= 0.1) return

        scale -= 0.1;
        itemOffPositionMap.forEach((value, key) => {
            setTranslate(value.x, value.y, key);
        })
    }

    document.getElementById("left-backBtn").addEventListener("mousedown", e => {
        if (focusSetNumberTable !== undefined) {
            focusSetNumberTable.classList.toggle("focus");
            focusSetNumberTable = undefined;
        }
        leftSideTab.classList.toggle("open");
    });


    const toolContainer = document.getElementById("tool-container");
    document.getElementById("tool-container-toggleBtn").addEventListener("mousedown", e => {
        toolContainer.classList.toggle("close");
        console.log(`target : ${e.target}`)
        e.target.textContent = e.target.textContent == ">" ? "<" : ">";
    })

</script>


</body>
</html>