<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css">
    <title>Title</title>
</head>
<body>
<div id="main-container">
    <div id="left-sideTab">
        <div class="floating-box" id="zoom-container">
            <button onclick="zoomIn()" class="zoom-btn">+</button>
            <button onclick="zoomOut()" class="zoom-btn">-</button>
        </div>

        <div id="left-backBtn" class="arrow-head"></div>

        <h2>Settings</h2>

        <div class="form-group">
            <label>Table ID</label>
            <input type="number" id="input-tableId" placeholder="Table id">
        </div>

        <div class="form-group">
            <span>Select Option</span>
            <div class="radio-group">
                <input type="radio" id="option1" name="tableSize" data-table-size="1" class="radio-custom">
                <label for="option1" class="radio-label">1 Ïù∏ÏÑù</label>

                <input type="radio" id="option2" name="tableSize" data-table-size="4" class="radio-custom">
                <label for="option2" class="radio-label">4 Ïù∏ÏÑù</label></div>
        </div>
    </div>

    <div id="workspace">

        <div class="container-line attachable item">
            <div class="container-draggable attachable" draggable="true">
            </div>
            <div class="container-draggable attachable" draggable="true">
            </div>

            <div class="container-draggable attachable" draggable="true">
            </div>
        </div>

        <div class="container-line attachable item">
            <div>
                <h3 style="margin: 0px" draggable="false">Area1</h3>
            </div>
            <div class="container-draggable attachable" draggable="true">
            </div>

            <div class="container-draggable attachable" draggable="true">
            </div>

            <div class="container-draggable attachable" draggable="true">
            </div>
        </div>
    </div>


    <div id="tool-container">
        <div style="height: 32%">
            <h3 style="margin: 0px; color: white;">Table</h3>
            <div class="tool-container-detail">
                <div style="justify-content: center; align-items: center; display: flex; height: 100%">
                    <div class="table-container">
                        <div style="height: 80%; justify-content: center; align-items: center; display: flex;">
                            <button id="table-1" data-table-size="1" data-table-id="1"
                                    class="draggable resource table-1" draggable="true" style="font-size: 7px;">
                                <h2>T 1<br>00:00</h2>
                            </button>
                        </div>
                        <p><1 Ïù∏ÏÑù></p>
                    </div>
                    <div class="table-container">
                        <div style="height: 80%; justify-content: center; align-items: center; display: flex;">

                            <button id="table-4" data-table-size="4" data-table-id="1"
                                    class="draggable resource table-4" draggable="true" style="font-size: 8px;">
                                <h2>T 1<br>00:00</h2>
                            </button>
                        </div>
                        <p><4 Ïù∏ÏÑù></p>
                    </div>
                </div>
            </div>
        </div>
        <div style="height: 32%">
            <h3 style="margin: 0px; color: white;">Line</h3>
            <div class="tool-container-detail"
                 style="display: grid; grid-template-rows: 1fr 1fr">
                <div class="container-draggable attachable resource" draggable="true"
                     style="flex-direction: column;  text-align: left">
                    Vertical
                </div>
                <div class="container-draggable attachable resource" draggable="true">
                    Horizontal
                </div>
            </div>
        </div>
        <div style="height: 32%">
            <h3 style="margin: 0px; color: white;">Area</h3>
            <div class="tool-container-detail" style="display: grid; grid-template-rows: 1fr 1fr">
                <div class="container-line attachable item resource" draggable="true" style="flex-direction: column;">
                    <h3 style="margin: 0px">Vertical</h3>
                </div>
                <div class="container-line attachable item resource" draggable="true" style="flex-direction: row">
                    <h3 style="margin: 0px; flex-direction: column">Horizontal</h3>
                </div>
            </div>
        </div>
        <button id="tool-container-toggleBtn" class="circle-button">&gt;</button>
        <div class="floating-box waste-btn" id="waste-container">
            üóë
        </div>
    </div>
</div>


<!-- ÏÇ≠Ï†úÎ°úÏßÅ2 -->
<!-- Î∂ÄÎ∂Ñ ÏÑ±Í≥µ : item ÏöîÏÜåÎäî ÎêòÎäîÎç∞ , draggable ÏöîÏÜåÎäî ÏïàÎê® -->
<!-- draggable Îäî waste_basket ÏóêÏÑú dragoverÎ°ú Ï≤òÎ¶¨Ìï¥ÏïºÌï† Í≤É Í∞ôÎã§.  -->
<script>
    //divÍ∞Ä Ï§ëÏ≤©ÎêòÏóàÎäîÏßÄ ÌôïÏù∏ÌïòÎäî Î©îÏÑúÎìú
    function isOverlapping(x, y) {
        const rect1 = x;
        const rect2 = y;

        return !(
            rect1.top > rect2.bottom ||
            rect1.right < rect2.left ||
            rect1.bottom < rect2.top ||
            rect1.left > rect2.right
        );
    }

    let inWasteBasket = false;

    //Ïì∞Î†àÍ∏∞ÌÜµ ÏïàÏúºÎ°ú ÏôîÏùÑ Îïå ÌåêÎã®Ìï¥ÏÑú Ìö®Í≥ºÎ•º Ï£ºÎäî Ìï®Ïàò
    function wasteIn(remove, position = remove.getBoundingClientRect()) {
        if (isOverlapping(position,
            wasteBasket.getBoundingClientRect())) { //Ïì∞Î†àÍ∏∞ÌÜµ ÏïàÏúºÎ°ú Îì§Ïñ¥ÏôîÎã§Î©¥
            if (inWasteBasket) return; //ÌÅ¥ÎûòÏä§Í∞Ä Í≥ÑÏÜç Ï∂îÍ∞ÄÎêòÎäî Í≤ΩÏö∞Î•º Î∞©ÏßÄÌïúÎã§.

            //css ÏòµÏÖòÏùÑ Ï§ÄÎã§.
            remove.classList.add("waste-in-object");
            wasteBasket.classList.add("waste-in");
            inWasteBasket = true;
        } else { //Í≤πÏπòÏßÄ ÏïäÏïòÎã§Î©¥ --> Ïì∞Î†àÍ∏∞ÌÜµ Î∞ñÏúºÎ°ú ÎÇòÏôîÎã§Î©¥
            //Ï∂îÍ∞ÄÌñàÎçò css ÏòµÏÖòÏùÑ Ï†úÍ±∞ÌïúÎã§.
            remove.classList.remove("waste-in-object");
            wasteBasket.classList.remove("waste-in");
            inWasteBasket = false;
        }
    }

    function setRemoveItemEvent(item) {
        //ÎßàÏö∞Ïä§ Ïò§Î≤ÑÎ•º Ìï† Îïå Ïì∞Î†àÍ∏∞ÌÜµ ÏïàÏóê Í∞ùÏ≤¥Í∞Ä ÏûàÎã§Î©¥ ÏÉâ Î≥ÄÍ≤Ω Î∞è ÌîåÎûòÍ∑∏ ÏÑ§Ï†ï
        item.addEventListener("mousemove", () => wasteIn(item));
        item.addEventListener("touchmove", () => wasteIn(item));

        //ÎßàÏö∞Ïä§Í∞Ä ÎÅùÎÇ¨ÏùÑ Îïå Î∞úÏÉùÌïòÎäî Ïù¥Î≤§Ìä∏
        item.addEventListener("mouseup", () => checkWasteOverlapping(item));
        item.addEventListener("touchend", () => checkWasteOverlapping(item));
    }

    function checkWasteOverlapping(item) {
        if (isOverlapping(wasteBasket.getBoundingClientRect(),
            item.getBoundingClientRect())) item.remove(); //ÎßàÏö∞Ïä§Î•º ÎÜìÏùÄ Í≥≥Ïù¥ Í∞ùÏ≤¥ ÏïàÏóê ÏûàÎã§Î©¥ Í∑∏ ÏöîÏÜåÎ•º ÏÇ¨Ï†ùÌïòÍ≤†Îã§.
        wasteBasket.classList.remove("waste-in");
    }

    function setRemoveDragEvent(drag) {
        drag.addEventListener("drag", e => {
            wasteIn(drag, new DOMRect(e.clientX, e.clientY, 1, 1))
        })

        drag.addEventListener("touchmove", e => {
            wasteIn(drag, new DOMRect(e.touches[0].clientX, e.touches[0].clientY, 1, 1))
        });

        drag.addEventListener("dragend", e => {
            if (isOverlapping(wasteBasket.getBoundingClientRect(),
                new DOMRect(e.clientX, e.clientY, 1, 1))) drag.remove();
            wasteBasket.classList.remove("waste-in"); //Ï¢ÖÎ£å ÏãúÏ†êÏóê Í≤∞Í≥ºÏóê ÏÉÅÍ¥ÄÏóÜÏù¥ Ìú¥ÏßÄÌÜµÏùÑ ÏõêÎûòÎåÄÎ°ú ÌïúÎã§.
        })

        drag.addEventListener("touchend", e => {
            e.stopPropagation();
            if (isOverlapping(wasteBasket.getBoundingClientRect(),
                new DOMRect(e.changedTouches[0].pageX, e.changedTouches[0].pageY, 1, 1))) drag.remove();
            wasteBasket.classList.remove("waste-in"); //Ï¢ÖÎ£å ÏãúÏ†êÏóê Í≤∞Í≥ºÏóê ÏÉÅÍ¥ÄÏóÜÏù¥ Ìú¥ÏßÄÌÜµÏùÑ ÏõêÎûòÎåÄÎ°ú ÌïúÎã§.
        })
    }

    //ÏûêÏú†Î°≠Í≤å ÏõÄÏßÅÏùº Ïàò ÏûàÎäî ÏöîÏÜåÎì§
    const removableItemList = document.querySelectorAll(".item");

    //Î∂ôÏó¨ÏßÄÎäî ÏöîÏÜåÎì§
    const removableDragList = document.querySelectorAll(".draggable, .container-draggable")
    const wasteBasket = document.getElementById("waste-container");

    removableItemList.forEach(removable => {
        setRemoveItemEvent(removable);
    })

    removableDragList.forEach(removable => {
        setRemoveDragEvent(removable);
    })
</script>

<!-- resource Î°úÏßÅ -->
<script>
    let resourceDragend;
    //Î™®Îì† ÏûêÏõêÏùÑ Í∞ÄÏ†∏Ïò®Îã§.
    let resources = document.querySelectorAll(".resource");

    resources.forEach(resource => {
        if (resource.classList.contains("item")) {
            resource.addEventListener("drag", e => {
                resourceDragend = resource;
            })



            resource.addEventListener("touchstart", e => {
                resourceDragend = resource;
            })

            resource.addEventListener("touchend", e => {
                resourceItemDrop(e);
            });
        }
    })

</script>

<!-- ÏûêÎ¶¨ Ïä§ÏúÑÏπ≠ Î°úÏßÅ -->
<script>
    let isDrag = false;
    //resourceÎ•º Í∞ÄÏ†∏Ïò®Îã§.
    //let resourceTableContainer = document.q(".resource.draggable").values();

    const leftSideTab = document.getElementById('left-sideTab');

    //Î∂ôÏù¥Îäî ÏöîÏÜåÎì§ Í∞ÄÏ†∏Ïò®Îã§.
    const draggables = document.querySelectorAll(".draggable");
    draggables.forEach(container => {
        setDraggableEvent(container);
    })

    //Î™®Îì† 1Îã®Í≥Ñ Ïª®ÌÖåÏù¥ÎÑàÎ•º Í∞ÄÏ†∏Ïò®Îã§.
    const draggableContainers = document.querySelectorAll(".container-draggable");
    draggableContainers.forEach(container => {
        setDraggableEvent(container);

        if (!container.classList.contains("resource")) {
            setContainerAttachEvent(container, "draggable");//Ïù¥ Ïª®ÌÖåÏù¥Ïóê Îã¥ÏùÑ Ïàò ÏûàÎäî ÏöîÏÜå
        }
    })

    //Î™®Îì† 2Îã®Í≥Ñ Ïª®ÌÖåÏù¥ÎÑàÎ•º Í∞ÄÏ†∏Ïò®Îã§.
    const lineContainers = document.querySelectorAll(".container-line");
    lineContainers.forEach(container => {
        if (!container.classList.contains("resource")) {
            setContainerAttachEvent(container, "container-draggable"); //Ïù¥ Ïª®ÌÖåÏù¥Ïóê Îã¥ÏùÑ Ïàò ÏûàÎäî ÏöîÏÜå
        }
    })

    //ÌÖåÏù¥Î∏î idÎ•º Î≥ÄÍ≤ΩÌïòÎäî Î°úÏßÅ
    let focusSetNumberTable;
    const inputTableId = document.getElementById("input-tableId");
    const tableSizeBtns = document.getElementsByName("tableSize");

    //ÌÖçÏä§Ìä∏ ÏÇ¨Ïö©ÏûêÏóê ÎÇ¥Ïö©Ïù¥ Î≥ÄÍ≤ΩÎêòÎäî Í≤ΩÏö∞
    inputTableId.addEventListener("change", e => {
        focusSetNumberTable.dataset.tableId = e.target.value;
        tabletNumberTextChange(focusSetNumberTable);
    })

    //ÏÇ¨Ïù¥Ï¶àÍ∞Ä Î≥ÄÌïòÎäî Í≤ΩÏö∞
    tableSizeBtns.forEach(btn => {
        btn.addEventListener("change", e => {
            focusSetNumberTable.classList.remove("table-" + focusSetNumberTable.dataset.tableSize);
            focusSetNumberTable.classList.add("table-" + btn.dataset.tableSize);
            focusSetNumberTable.dataset.tableSize = btn.dataset.tableSize;
        });
    })

    //ÌÅ¥Î¶≠Ìï¥ÏÑú ÌÖåÏù¥Î∏î Î≤àÌò∏ Ï†ÄÏû•
    function setNumberTable(table) {
        if (focusSetNumberTable !== undefined)
            focusSetNumberTable.classList.toggle("focus"); //ÏõêÎûò ÏÑ†ÌÉùÎêú Í∞ùÏ≤¥ ÏÑ†ÌÉù Ìï¥Ï†ú

        if (focusSetNumberTable === table) { //Í∏∞Ï°¥Ïóê ÏÑ†ÌÉùÌïú ÌÖåÏù¥Î∏î Îã§Ïãú ÏÑ†ÌÉùÌïòÎ©¥ Ï∑®ÏÜå
            focusSetNumberTable = undefined;
            leftSideTab.classList.remove("open");
            return;
        }

        focusSetNumberTable = table;
        focusSetNumberTable.classList.toggle("focus");

        tableSizeBtns.forEach(btn => {
            console.log(`table ${table.dataset.tableSize}`)
            if (btn.dataset.tableSize === table.dataset.tableSize)
                btn.checked = true;
        })

        inputTableId.value = Number(table.dataset.tableId);
        leftSideTab.classList.add("open");
    }

    let afterImage; //tocuh ÌñàÏùÑ Îïå ÏûêÏÉÅ Ïù¥ÎØ∏ÏßÄÎ•º Î≥¥Ïó¨Ï§ÄÎã§.
    let touchedFlag = false;

    //ÎìúÎ†àÍ∑∏
    function setDraggableEvent(draggable) {
        //ÎìúÎ†àÍ∑∏Í∞Ä ÏãúÏûëÎêú Í≤ΩÏö∞ ÏÉÅÌÉúÎ•º Î≥ÄÍ≤Ω
        draggable.addEventListener("dragstart", e => setStartDragEvent(draggable, e));
        draggable.addEventListener("touchstart", e => {
            setStartDragEvent(draggable, e);
        });

        draggable.addEventListener("touchmove", e => {
            if(touchedFlag) return;
            touchedFlag = true;
            //ÏûîÏÉÅ Ï≤òÎ¶¨
            afterImage = draggable.cloneNode(true);
            console.log(`afterImage ${afterImage}`)

            afterImage.removeAttribute("id");
            afterImage.classList.add("afterImage")
            document.getElementById("main-container").appendChild(afterImage);

        })

        //ÎìúÎ†àÍ∑∏Í∞Ä ÎÅùÎÇòÎ©¥ ÏÉÅÌÉúÎ•º Ï¢ÖÎ£åÌïúÎã§.
        draggable.addEventListener("dragend", e => setEndDragEvent(draggable, e));
        draggable.addEventListener("touchend", e => {
            setEndDragEvent(draggable, e);
            afterImage.remove();
            touchedFlag = false;
        });
    }


    document.addEventListener("touchmove", e => {
        if(afterImage === undefined) return;

        setTranslate(e.touches[0].clientX - afterImage.getBoundingClientRect().width / 2
            , e.touches[0].clientY - afterImage.getBoundingClientRect().height / 2
            , afterImage);

        const touchElement = document.elementFromPoint(e.touches[0].clientX, e.touches[0].clientY);

        if(touchElement.classList.contains("attachable")){
            const isHorizontal = getComputedStyle(touchElement).flexDirection === "row";
            draggableInContainer(touchElement, getTargetType(touchElement), e, isHorizontal);
        }

    })

    function setStartDragEvent(draggable, event) {
        event.stopPropagation()
        isDrag = true;
        draggable.classList.add("dragging");
        console.log("drag start!")
    }

    function setEndDragEvent(draggable, event) {
        //event.stopPropagation(); // Ï¢ÖÎ£åÎêòÎäîÍ±¥ Ï†ÑÌååÎêòÏñ¥ÎèÑ ÎêòÏßÄ ÏïäÏùÑÍπå?
        isDrag = false;
        draggable.classList.remove("dragging");
        console.log("drag end!")
    }

    function getTargetType(container){
        let targetType;

        if (container.classList.contains("container-draggable"))
            targetType = "draggable";
        else if (container.classList.contains("container-line"))
            targetType = "container-draggable";


        return targetType;
    }


    function setContainerAttachEvent(container, target) {
        let targetType = target === undefined ? getTargetType(container) : target;

        const isHorizontal = getComputedStyle(container).flexDirection === "row";

        //ÎßàÏö∞Ïä§Í∞Ä container ÏòÅÏó≠ÏúºÎ°ú Ïù¥ÎèôÌñàÎã§Î©¥
        container.addEventListener("dragover", e => { //ÎìúÎ†àÍ∑∏ Ïò§Î≤Ñ ÏÉÅÌÉúÎ©¥ Í≥ÑÏÜç Î∞úÏÉùÌïòÎäî Ïù¥Î≤§Ìä∏
            draggableInContainer(container, targetType, e, isHorizontal);
        });
        // container.addEventListener("touchmove", e=> {
        //     draggableInContainer(container, targetType, e, isHorizontal);
        // })
    }

    function draggableInContainer(container, targetType, event, isHorizontal) {
        //Î™®Îì† Ïª®ÌÖåÏù¥ÎÑàÎì§Ïóê ÎåÄÌï¥ÏÑú Ïù¥Î≤§Ìä∏Î•º Ï∂îÍ∞ÄÌïúÎã§.
        let draggable = document.querySelector(".dragging"); //ÏÑ†ÌÉùÎêú Ìï≠Î™©ÏùÑ Í∞ÄÏ†∏Ïò®Îã§.
        console.log("dragover! : " + draggable);

        if (draggable === null) return;
        if (!draggable.classList.contains(targetType)) return //containerÏóê ÎÑ£ÏùÑ Ïàò ÏûàÎäî Ìï≠Î™©Ïù∏ÏßÄ ÌôïÏù∏ÌïúÎã§.


        event.preventDefault(); //Ïñ¥Îñ§ ÏùòÎØ∏Ïù∏ÏßÄ Ïûò Î™®Î•¥Í≤†Íµ∞... ÌäπÏ†ï Ïù¥Î≤§Ìä∏Î•º Ï§ëÏãúÌÇ§Îäî Í≤É Í∞ôÍ∏¥ÌïúÎç∞...
        //event.stopPropagation(); //Î∂ÄÎ™® Í∞ùÏ≤¥Î°ú ÏòàÏô∏ Ï†ÑÌåå Î∞©ÏßÄ --> ÏúÑÏóêÏÑú ÏòàÏô∏Ï≤òÎ¶¨ ÌïòÍ∏∞ ÎïåÎ¨∏Ïóê ÏóÜÏñ¥ÎèÑ Í¥úÏ∞ÆÏùÑ ÎìØ

        const afterElement = getDragAfterElement(container, event, targetType, isHorizontal); //ÎßàÏö∞Ïä§ Ï¢åÌëúÏóêÏÑú Í∞ÄÏû• Ïò§Î•∏Ï™ΩÏóê ÏûàÎäî Ìï≠Î™©ÏùÑ Í∞ÄÏ†∏Ïò®Îã§.

        if (draggable.classList.contains("resource")) { //ÏÇ≠Ï†úÎêòÏßÄ ÏïäÎäî ÏöîÏÜåÎùºÍ≥† ÌïòÎ©¥
            let x = draggable.cloneNode(true);

            //Ïù¥Î≤§Ìä∏ Î∞îÏù∏Îî©
            setDraggableEvent(x);
            setRemoveDragEvent(x);
            if (draggable.classList.contains("container-draggable")) {
                setContainerAttachEvent(draggable, "draggable");
                draggable.innerText = draggable.innerText.trim().substring(0, 1);
            }

            x.classList.remove("dragging");
            draggable.classList.remove("resource");
            draggable.removeAttribute("id");
            console.log("id : " + x.id.toString())

            draggable.after(x);

            //ÌÖåÏù¥Î∏î Î≤àÌò∏ ÏµúÏã†Ìôî
            if (x.classList.contains("draggable")) {
                draggable.addEventListener("mousedown", e => {
                    e.stopPropagation();
                    setNumberTable(draggable);
                });

                // draggable.addEventListener("touchstart", e => {
                //     setNumberTable(draggable);
                // })
                const tableNumber = (Number(draggable.dataset.tableId) + 1).toString();
                tableNumberTable(tableNumber);
            }
        }

        if (afterElement === undefined) { //Ïò§Î•∏Ï™ΩÏóê Ìï≠Î™©Ïù¥ ÏóÜÎã§Î©¥
            container.appendChild(draggable); //Í∞ÄÏû• Îí§Ïóê Ï∂îÍ∞ÄÌï¥Ï§ÄÎã§.
        } else {
            container.insertBefore(draggable, afterElement);
        }
    }


    function tableNumberTable(tableNumber) {
        const table1 = document.getElementById("table-1");
        const table4 = document.getElementById("table-4");

        table1.dataset.tableId = tableNumber;
        table4.dataset.tableId = tableNumber;

        tabletNumberTextChange(table1);
        tabletNumberTextChange(table4);
    }

    function tabletNumberTextChange(table) {
        table.innerHTML = `<h2>T ${table.dataset.tableId}<br>00:00</h2>`;
    }

    //Ïª®ÌÖåÏù¥ÌÑ∞ ÎÇ¥Ïóê ÏÑ†ÌÉùÎêòÏßÄ ÏïäÏùÄ Ìï≠Î™©Îì§ Ï§ëÏóê ÎßàÏö∞Ïä§ ÏôºÏ©çÏóê ÏûàÎäî Ìï≠Î™©ÏùÑ Î¶¨ÌÑ¥ÌïòÎäî Ìï®Ïàò
    function getDragAfterElement(container, e, targetType, isHorizontal) {
        const draggableElements = [
            //... -> Î∞∞Ïó¥Î°ú Í∞ÄÏ†∏Ïò®Îã§.
            ...container.querySelectorAll(`.${targetType}:not(.dragging)`), // Ïª®ÌÖåÏù¥ÎÑà Î™©Î°ùÏ§ëÏóê targetType ÏöîÏÜåÏ§ë dragging Ïù¥ ÏïÑÎãå Í≤ÉÏùÑ Í∞ÄÏ†∏Ïò®Îã§.
        ];

        //ÏÑ†ÌÉùÎêòÏßÄ ÏïäÏùÄ Ìï≠Î™©Îì§Ïùò ÎßàÏö∞Ïä§Î•º Í∏∞Ï§ÄÏúºÎ°ú Í∞ÄÏû• Ïò§Î•∏Ï™ΩÏóê ÏûàÎäî Ìï≠Î™©ÏùÑ Í∞ÄÏ†∏Ïò®Îã§.
        return draggableElements.reduce( //ÏΩúÎ∞± Î©îÏÑúÎìúÎ•º Î∞∞Ïó¥ ÎßåÌÅº Ïã§ÌñâÌïòÍ≥† ÌïòÎÇòÏùò Í∞íÏùÑ Î∞òÌôòÌïòÎäî Ìï®Ïàò
            (closest, child) => {
                const box = child.getBoundingClientRect(); //ÎèÑÌòï Ï†ïÎ≥¥Î•º Í∞ÄÏ†∏Ïò®Îã§.
                //ÎßàÏö∞Ïä§ xÏ¢åÌëú - Î∞ïÏä§ ÏôºÏ™Ω ÏúÑÏπò - Î∞ïÏä§ ÎÑìÏù¥ / 2
                //affset Í∞íÏù¥ ÏùåÏàòÎùºÎ©¥ ÎßàÏö∞Ïä§ Í∏∞Ï§ÄÏúºÎ°ú Î∞ïÏä§ Ï§ëÏã¨Ïù¥ Ïò§Î•∏Ï™ΩÏóê ÏûàÍ≥† ÏñëÏàòÎùºÎ©¥ ÏôºÏ™ΩÏóê ÏûàÎã§.(Î∞ïÏä§Î•º Í∏∞Ï§ÄÏúºÎ°ú ÎßàÏö∞Ïä§Îäî ÏôºÏ™Ω, Ïò§Î•∏Ï™ΩÏóê ÏûàÎã§.)
                let offset;
                if (isHorizontal)
                    offset = (e.type === "dragover" ? e.clientX : e.touches[0].clientX)
                        - (box.left + box.width / 2);
                else
                    offset =(e.type === "dragover" ? e.clientY : e.touches[0].clientY)
                        - (box.top + box.height / 2);

                //ÎßàÏö∞Ïä§ Ï¢åÌëúÍ∞Ä ÎèÑÌòïÎ≥¥Îã§ ÏôºÏ™ΩÏóê ÏûàÍ≥† Ï†Ñ Ìï≠Î™©Î≥¥Îã§ 0Ïóê Í∞ÄÍπùÎã§Î©¥ offsetÍ∞íÍ≥º Ìï≠Î™©ÏùÑ Í∞±Ïã†
                if (offset < 0 && offset > closest.offset) {
                    return {offset: offset, element: child};
                } else { //ÏïÑÎãàÎ©¥ ÏõêÎûò Í∞í Îã§Ïãú Í∞±Ïã†
                    return closest;
                }
            },
            {offset: Number.NEGATIVE_INFINITY}
        ).element;
    }
</script>

<!-- ÏûêÏú†Î°≠Í≤å ÏõÄÏßÅÏù¥Îäî Î°úÏßÅ -->
<script>
    //itemÎ•º ÏûêÍ≤®Ïò®Îã§.
    var dragItem = document.querySelectorAll(".item");
    //containerÎ•º Í∞ÄÏ†∏Ïò®Îã§.
    var container = document.querySelector("#workspace");

    var active = false;
    var target
    var currentX;
    var currentY;
    var initialX;
    var initialY;
    //translate3dÏóê ÏûàÎäî Í∞íÏùÑ Î∞òÏòÅÌï¥ÏïºÌïòÍ∏∞ ÎïåÎ¨∏Ïóê Offset Í∞íÏùÑ Ï†ÄÏû•Ìï¥Ïïº ÎêúÎã§.
    var itemOffPositionMap = new Map();
    dragItem.forEach(item => {
        if (item.classList.contains("resource"))
            return;
        itemOffPositionMap.set(item, {x: 0, y: 0});
    })

    //ÌÑ∞Ïπò Ïù¥Î≤§Ìä∏Ïóê ÎåÄÌïú Ï≤òÎ¶¨
    container.addEventListener("touchstart", dragStart, false);
    container.addEventListener("touchend", dragEnd, false);
    container.addEventListener("touchmove", drag, false);
    //ÎßàÏö∞Ïä§ ÌÅ¥Î¶≠Ïóê ÎåÄÌïú Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
    container.addEventListener("mousedown", dragStart, false);
    container.addEventListener("mouseup", dragEnd, false);
    container.addEventListener("mousemove", drag, false);

    //resource itemÏù∏ drop Îêú Í≤ΩÏö∞
    container.addEventListener("drop", e => {
        resourceItemDrop(e);
    });



    function resourceItemDrop(e){
        e.preventDefault();
        if (resourceDragend === undefined) return;
        let clone = resourceDragend.cloneNode(true); //ÍπäÏùÄ Î≥µÏÇ¨
        let isTouch = e.type === "touchend";

        //itemÏóê ÎßûÎäî ÏÜçÏÑ±ÏúºÎ°ú Ï¥àÍ∏∞Ìôî
        clone.classList.remove("resource");
        clone.draggable = false;
        clone.style.position = "absolute"
        container.appendChild(clone);

        //Ï§ëÏã¨ÏùÑ Í∏∞Ï§ÄÏúºÎ°ú Ï¢åÌëú Íµ¨ÌïòÍ∏∞ Î∞è mapÏóê Îì±Î°ù
        console.log("isTouch : " + isTouch);
        let initPosition = {
            x: (isTouch ? e.changedTouches[0].pageX : e.clientX) - container.getBoundingClientRect().width / 2,
            y: (isTouch ? e.changedTouches[0].pageY : e.clientY) - container.getBoundingClientRect().height / 2
        };


        itemOffPositionMap.set(clone, initPosition);

        //Íµ¨Ìïú Ï¢åÌëúÎ°ú Ïù¥Îèô Î∞è
        setTranslate(initPosition.x, initPosition.y, clone);

        //ÌÖçÏä§Ìä∏ Î≥ÄÍ≤Ω
        clone.innerHTML = `<h3 style="margin: 0px">${clone.innerText.trim().substring(0, 1)}</h3>`;


        //Ïù¥Î≤§Ìä∏ Î∞îÏù∏Îìú
        setContainerAttachEvent(clone);
        setRemoveItemEvent(clone);

        resourceDragend = undefined;
    }


    container.addEventListener("dragover", e => e.preventDefault());

    function dragStart(e) {
        if (isDrag) return;
        if (active || e.target === container) return
        if (e.target.draggable == true) return;
        target = e.target

        while (target.parentNode !== container) {
            target = target.parentNode;
        }

        if (itemOffPositionMap.has(target)) { //dragItem Ïù¥ ÌÅ¥Î¶∞Îêú Í≤ΩÏö∞
            let offset = itemOffPositionMap.get(target);

            if (e.type === "touchstart") {
                initialX = e.touches[0].clientX - offset.x
                initialY = e.touches[0].clientY - offset.y
            } else {
                initialX = e.clientX - offset.x;
                initialY = e.clientY - offset.y;
            }

            active = true;
        }
    }

    function dragEnd() {
        if (active) { //dragItem Ïù¥ ÌÅ¥Î¶∞Îêú Í≤ΩÏö∞
            var offset = itemOffPositionMap.get(target)
            offset.x = currentX
            offset.y = currentY
        }
        active = false;
    }

    function drag(e) {
        if (active) { //dragItem ÏÑ†ÌÉùÎêú Í≤ΩÏö∞
            e.preventDefault();

            if (e.type === "touchmove") { //ÌÑ∞ÏπòÌïú ÏÉÅÌÉúÎ°ú Ïù¥ÎèôÌïú Í≤ΩÏö∞
                currentX = e.touches[0].clientX - initialX;
                currentY = e.touches[0].clientY - initialY;
            } else { //ÎßàÏö∞Ïä§Î°ú Ïù¥ÎèôÌïòÎäî Í≤ΩÏö∞
                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;
            }

            setTranslate(currentX, currentY, target);
        }
    }

    let scale = 1;

    function setTranslate(xPos, yPos, el) {
        el.style.transform = "translate3d(" + xPos + "px, " + yPos + "px, 0) scale(" + scale + ")";
    }

</script>

<!-- Ï§åÏù∏ ÏïÑÏõÉ -->
<!-- ÏôºÏ™Ω ÌôîÎ©¥ Ï†ëÍ∏∞ -->
<script>

    function zoomIn() {
        scale += 0.1;
        itemOffPositionMap.values()
        itemOffPositionMap.forEach((value, key) => {
            setTranslate(value.x, value.y, key);
        })

    }

    function zoomOut() {
        if (scale <= 0.1) return

        scale -= 0.1;
        itemOffPositionMap.forEach((value, key) => {
            setTranslate(value.x, value.y, key);
        })
    }

    document.getElementById("left-backBtn").addEventListener("mousedown", e => {
        if (focusSetNumberTable !== undefined) {
            focusSetNumberTable.classList.toggle("focus");
            focusSetNumberTable = undefined;
        }
        leftSideTab.classList.toggle("open");
    });


    const toolContainer = document.getElementById("tool-container");
    document.getElementById("tool-container-toggleBtn").addEventListener("mousedown", e => {
        toolContainer.classList.toggle("close");
        console.log(`target : ${e.target}`)
        e.target.textContent = e.target.textContent == ">" ? "<" : ">";
    })

</script>


</body>
</html>